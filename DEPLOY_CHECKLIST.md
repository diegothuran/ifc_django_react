# ‚úÖ Checklist de Deploy no Render

## üìã Pr√©-Deploy

### Arquivos Necess√°rios
- [x] `render.yaml` - Configura√ß√£o do Render
- [x] `build.sh` - Script de build
- [x] `start_simple.sh` - Script de inicializa√ß√£o
- [x] `requirements.txt` - Depend√™ncias Python
- [x] `runtime.txt` - Vers√£o do Python (3.11.10)
- [x] `.renderignore` - Arquivos a ignorar no deploy
- [x] `Procfile` - Configura√ß√£o alternativa

### Configura√ß√µes Django
- [x] `DEBUG=False` em produ√ß√£o
- [x] `SECRET_KEY` gerada automaticamente
- [x] `ALLOWED_HOSTS` configurado
- [x] WhiteNoise para arquivos est√°ticos
- [x] PostgreSQL configurado via DATABASE_URL
- [x] Cache configurado (PostgreSQL)

---

## üöÄ Passos para Deploy

### 1. Preparar Reposit√≥rio GitHub
```bash
# Fazer commit de todas as altera√ß√µes
git add .
git commit -m "Preparado para deploy no Render"
git push origin main
```

### 2. Criar Conta no Render
- Acesse: https://render.com/
- Fa√ßa login com GitHub
- Autorize o Render a acessar seus reposit√≥rios

### 3. Criar Web Service

#### Op√ß√£o A: Deploy via render.yaml (Recomendado)
1. No Render Dashboard, clique em **"New +"**
2. Selecione **"Blueprint"**
3. Conecte seu reposit√≥rio GitHub
4. O Render detectar√° o `render.yaml` automaticamente
5. Clique em **"Apply"**

#### Op√ß√£o B: Deploy Manual
1. No Render Dashboard, clique em **"New +"**
2. Selecione **"Web Service"**
3. Conecte seu reposit√≥rio GitHub
4. Configure:
   ```
   Name: digital-twin-django
   Runtime: Python 3
   Build Command: chmod +x build.sh && ./build.sh
   Start Command: chmod +x start_simple.sh && ./start_simple.sh
   ```

### 4. Configurar Banco de Dados PostgreSQL

**Se usou render.yaml**: O banco ser√° criado automaticamente!

**Se fez deploy manual**:
1. No Render Dashboard, clique em **"New +"**
2. Selecione **"PostgreSQL"**
3. Configure:
   ```
   Name: ifc-monitoring-db
   Database: ifc_monitoring
   User: ifc_user
   Plan: Free
   ```
4. Ap√≥s criar, copie a **Internal Database URL**
5. V√° para o Web Service ‚Üí Environment
6. Adicione vari√°vel `DATABASE_URL` com o valor copiado

### 5. Verificar Vari√°veis de Ambiente

No Web Service, verifique em **Environment**:

```bash
DATABASE_URL=<automatic from database>
SECRET_KEY=<auto-generated>
DEBUG=False
WEB_CONCURRENCY=4
ALLOWED_HOSTS=.onrender.com
DJANGO_SETTINGS_MODULE=ifc_monitoring.settings
RENDER=true
AUTO_SETUP_DATA=true
```

### 6. Deploy!

- O Render iniciar√° o build automaticamente
- Acompanhe os logs em **Logs**
- Aguarde mensagem "Build successful"
- Aguarde mensagem "Deploy live"

---

## üîç Verifica√ß√µes P√≥s-Deploy

### Testar Endpoints

```bash
# Substituir YOUR-APP-NAME pelo nome do seu servi√ßo
APP_URL=https://YOUR-APP-NAME.onrender.com

# 1. Testar p√°gina inicial
curl $APP_URL

# 2. Testar admin
curl $APP_URL/admin/

# 3. Testar API
curl $APP_URL/api/

# 4. Testar dashboard
curl $APP_URL/dashboard/
```

### Acessar Admin
1. Acesse: `https://YOUR-APP-NAME.onrender.com/admin/`
2. Login:
   - **Usu√°rio**: `admin`
   - **Senha**: `admin123`
3. **IMPORTANTE**: Altere a senha imediatamente!

### Verificar Logs
```
Dashboard ‚Üí Seu Service ‚Üí Logs
```

Procure por:
- ‚úÖ `Build conclu√≠do com sucesso`
- ‚úÖ `Migra√ß√µes executadas`
- ‚úÖ `Arquivos est√°ticos coletados`
- ‚úÖ `Superusu√°rio criado`
- ‚úÖ `Servidor Gunicorn iniciado`

---

## üîß Comandos √öteis no Render Shell

Acesse: **Dashboard ‚Üí Service ‚Üí Shell**

```bash
# Abrir shell Django
python manage.py shell

# Ver superusu√°rios
python manage.py shell -c "from django.contrib.auth import get_user_model; User = get_user_model(); print(User.objects.filter(is_superuser=True).values())"

# Testar cache
python manage.py shell -c "from django.core.cache import cache; cache.set('test', 'ok'); print(cache.get('test'))"

# Ver tabelas do banco
python manage.py dbshell

# Coletar statics novamente
python manage.py collectstatic --noinput

# Rodar migra√ß√µes
python manage.py migrate

# Criar superusu√°rio adicional
python manage.py createsuperuser
```

---

## üö® Troubleshooting

### Build Falha

**Erro: "Permission denied: build.sh"**
```bash
# Localmente, tornar execut√°vel:
chmod +x build.sh start_simple.sh
git add build.sh start_simple.sh
git commit -m "Add execute permission to scripts"
git push
```

**Erro: "Module not found"**
- Verificar `requirements.txt`
- Garantir que todas as depend√™ncias est√£o listadas

### Deploy Falha

**Erro: "Application failed to start"**
1. Verificar logs em **Dashboard ‚Üí Logs**
2. Verificar se `DATABASE_URL` est√° configurada
3. Verificar se migra√ß√µes foram executadas

**Erro: "Static files not found"**
```bash
# No Render Shell:
python manage.py collectstatic --noinput
```

### Banco de Dados

**Erro: "Could not connect to database"**
1. Verificar se o PostgreSQL est√° ativo
2. Verificar `DATABASE_URL` no Environment
3. Reiniciar o Web Service

### Cache N√£o Funciona

```bash
# No Render Shell:
python manage.py createcachetable
```

---

## üìä Monitoramento

### M√©tricas Importantes
- **Response Time**: Deve estar < 1s
- **Memory Usage**: Monitorar em Dashboard
- **Database Connections**: M√°ximo 20 no plano free

### Logs
```bash
# Ver logs em tempo real
Dashboard ‚Üí Service ‚Üí Logs

# Filtrar por erro
Buscar por: ERROR, CRITICAL, Exception
```

### Alertas
Configure em **Dashboard ‚Üí Service ‚Üí Settings ‚Üí Notifications**

---

## üîê Seguran√ßa

### Checklist de Seguran√ßa
- [ ] Alterar senha do admin
- [ ] Revisar `ALLOWED_HOSTS`
- [ ] Verificar `DEBUG=False`
- [ ] Configurar HTTPS (autom√°tico no Render)
- [ ] Revisar permiss√µes de usu√°rios

### Backup do Banco
```bash
# No Dashboard do PostgreSQL:
Settings ‚Üí Backups ‚Üí Enable Automatic Backups
```

---

## üí∞ Custos Estimados

### Plano Free (Recomendado para Teste)
- **Web Service**: Free (com limita√ß√µes)
- **PostgreSQL**: Free (compartilhado, expira em 90 dias)
- **Total**: **$0/m√™s**

**Limita√ß√µes Free Tier**:
- Servi√ßo hiberna ap√≥s 15 min de inatividade
- Banco expira ap√≥s 90 dias
- 750 horas/m√™s de computa√ß√£o

### Plano Starter (Recomendado para Produ√ß√£o)
- **Web Service**: $7/m√™s
- **PostgreSQL**: $7/m√™s
- **Total**: **$14/m√™s**

**Benef√≠cios Starter**:
- Servi√ßo sempre ativo
- Banco persistente
- Mais recursos
- Suporte priorit√°rio

---

## üìö URLs Importantes

| URL | Descri√ß√£o |
|-----|-----------|
| `https://YOUR-APP.onrender.com/` | P√°gina inicial |
| `https://YOUR-APP.onrender.com/admin/` | Admin Django |
| `https://YOUR-APP.onrender.com/dashboard/` | Dashboard p√∫blico |
| `https://YOUR-APP.onrender.com/plant/` | Visualizador de plantas |
| `https://YOUR-APP.onrender.com/sensors/` | Gerenciamento de sensores |
| `https://YOUR-APP.onrender.com/api/` | API REST |

---

## üéØ Pr√≥ximos Passos Ap√≥s Deploy

1. [ ] Alterar senha do admin
2. [ ] Testar todas as funcionalidades
3. [ ] Fazer upload de arquivo IFC de teste
4. [ ] Criar sensores reais
5. [ ] Configurar dom√≠nio customizado (opcional)
6. [ ] Configurar alertas de monitoramento
7. [ ] Documentar API para equipe
8. [ ] Configurar backup autom√°tico

---

## üìû Suporte

### Documenta√ß√£o Render
- https://render.com/docs

### Documenta√ß√£o do Projeto
- `docs/QUICK_START_RENDER.md`
- `docs/README.md`
- `GUIA_DO_USUARIO.md`

### Logs de Erro
Todos os erros s√£o logados em:
- **Render Dashboard ‚Üí Logs**
- **Arquivo**: `/tmp/django.log` (em produ√ß√£o)

---

**‚úÖ Projeto pronto para deploy no Render!**

Data da √∫ltima atualiza√ß√£o: Outubro 2024

